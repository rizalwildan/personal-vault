# Story 1.5: Development Scripts and Documentation

**Status:** Approved
**Priority:** High
**Estimate:** 1 day
**Epic:** Epic 1 — Foundation & Infrastructure Setup

---

## Story

**As a** new developer,
**I want** concise, runnable development scripts and a setup guide,
**so that** I can start the full development environment quickly and reliably on my machine.

---

## Acceptance Criteria

1. `./scripts/dev.sh` starts all services and waits for health checks, finishing with a clear "ready" message showing service URLs (Frontend, Backend, Swagger).
2. `./scripts/reset-db.sh` stops containers if running, drops and recreates the development database, re-runs migrations, and restarts containers.
3. `./scripts/seed.sh` placeholder exists (no data yet) and is executable.
4. `README.md` contains a Getting Started section with copyable commands to run the dev environment.
5. `docs/setup-guide.md` includes troubleshooting for Docker common issues on macOS and Linux.
6. All scripts are executable (`chmod +x scripts/*`) and committed.
7. `.dockerignore` and `.gitignore` updated where relevant.

---

## Tasks / Subtasks

- [ ] Create `scripts/dev.sh` (AC: 1)
  - [ ] Start `docker-compose up -d` in detached mode
  - [ ] Wait for PostgreSQL using health check: `until docker-compose exec -T postgres pg_isready -U postgres; do sleep 1; done`
  - [ ] Run migrations (`cd backend && bun run db:migrate`) and surface errors
  - [ ] Print formatted ready message with service URLs:
    ```
    ✅ Development environment ready!
       Frontend: http://localhost:3000
       Backend:  http://localhost:8000
       Swagger:  http://localhost:8000/swagger
    ```
  - [ ] Script must be idempotent (safe to run multiple times)
- [ ] Create `scripts/reset-db.sh` (AC: 2)
  - [ ] Stop containers: `docker-compose down`
  - [ ] Remove database volume to ensure clean state
  - [ ] Start containers: `docker-compose up -d`
  - [ ] Wait for PostgreSQL ready
  - [ ] Run migrations: `cd backend && bun run db:migrate`
  - [ ] Print confirmation message when complete
- [ ] Add `scripts/seed.sh` placeholder (AC: 3)
  - [ ] Create executable bash script with shebang
  - [ ] Add comment: "Placeholder for database seeding. Will be implemented in Epic 3: Backend Notes CRUD."
  - [ ] Print message: "No seed data defined yet."
  - [ ] Exit with success code (0)
- [ ] Update `README.md` Getting Started section (AC: 4)
- [ ] Add `docs/setup-guide.md` with troubleshooting (AC: 5)
  - [ ] Document macOS Docker permission issues and common fixes
  - [ ] Document how to inspect container logs and run migrations manually
- [ ] Ensure scripts are executable (AC: 6)
- [ ] Update `.dockerignore` and `.gitignore` (AC: 7)
- [ ] Commit changes and verify `./scripts/dev.sh` completes successfully in local run

---

## Dev Notes

### Source Tree Context

Current project structure (relevant portions):

```
personal-vault/
├── scripts/              # CREATE THIS DIRECTORY - does not exist yet
│   ├── dev.sh           # NEW - main development launcher
│   ├── reset-db.sh      # NEW - database reset utility
│   └── seed.sh          # NEW - placeholder for Epic 3
├── docker-compose.yml   # EXISTS (Epic 1 Story 1)
├── README.md            # EXISTS - update Getting Started section
├── backend/             # EXISTS (Epic 1 Stories 3 & 4)
│   └── drizzle/         # EXISTS - migrations directory
└── docs/
    └── setup-guide.md   # NEW - troubleshooting documentation
```

### Implementation Context

- **Source artifacts:** `docker-compose.yml` at repo root, `backend/` (Elysia + Drizzle), `drizzle/` migrations directory, and `README.md` file in repo root.
- **Existing behavior:** Docker Compose and Drizzle migrations already scaffolded as described in Epic 1. The `docker-compose.yml` at repo root already includes `frontend`, `backend`, and `postgres` services (verified in Epic 1 Stories 1-4).
- **Database connection:** Backend connects using DATABASE_URL environment variable defined in docker-compose.yml
- **Migration command:** `bun run db:migrate` is configured in backend/package.json (Epic 1 Story 4)

### Idempotency Requirements

- **dev.sh idempotency:** Script must handle being run multiple times safely:
  - If containers already running, `docker-compose up -d` will not error (idempotent by default)
  - Migrations are idempotent by nature (Drizzle only applies new migrations)
  - Script should print success message every time, even if no changes needed
- **reset-db.sh idempotency:** Script should work from any state (containers running or stopped)
- **seed.sh:** Placeholder only - no idempotency requirements yet (Epic 3 will implement)

### File locations and commands (for the dev agent)

- Start dev environment:

```bash
./scripts/dev.sh
```

- Reset DB locally:

```bash
./scripts/reset-db.sh
```

- Run migrations manually (from repo root):

```bash
cd backend && bun run db:migrate
```

---

## Testing

- Manual: Run `./scripts/dev.sh` on macOS and verify the script prints the ready message and the backend `/health` endpoint returns `200`.
- DB: Connect via psql to verify migrations applied: `psql -h localhost -U postgres -d personal_vault` and check `pg_extension` for `vector`.
- CI: Add a lightweight smoke test job later that runs `docker-compose up --build -d`, waits for `/health`, runs basic curl checks, then tears down.

---

## Change Log

| Date       | Version | Description                                    | Author             |
| ---------- | ------- | ---------------------------------------------- | ------------------ |
| 2026-02-17 | 0.1     | Initial draft created from Epic 1 content      | Bob (Scrum Master) |
| 2026-02-17 | 0.2     | Fixed implementation details per PO validation | Sarah (PO)         |

---

## QA Results

(To be filled by QA agent after implementation)
